#!/bin/bash

tmpdir=$(mktemp -d)

sdcc $1 -o "$tmpdir/tmp.ihx"
if [ $? -ne 0 ]; then
  rm -rf $tmpdir
  exit 1
fi

packihx "$tmpdir/tmp.ihx" >"$tmpdir/tmp.hex"

stcflash "$tmpdir/tmp.hex"
if [ $? -ne 0 ]; then
  rm -rf $tmpdir
  exit 1
fi
echo "Flash successful"
